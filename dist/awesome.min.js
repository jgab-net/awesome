"use strict";Array.prototype.find||(Array.prototype.find=function(e){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,s=Object(this),i=s.length>>>0,n=arguments[1],l=0;i>l;l++)if(t=s[l],e.call(n,t,l,s))return t;return void 0}),angular.module("netAwesome",[]).directive("netAwesome",["$parse","$timeout","$document","AwesomeService",function(e,t,s,i){return{restrict:"E",require:"^ngModel",replace:!0,templateUrl:"views/awesome.component.html",controllerAs:"awesome",bindToController:!0,transclude:!0,scope:{placeholder:"@?",base:"@list",filter:"@",childrens:"@",cacheKey:"@",getItem:"&?",limit:"=",alias:"@",itemHeight:"@?",sortItems:"&?"},controller:["$scope","$element","$attrs",function(t,n,l){this.filter=this.filter||"label",this.placeholder=this.placeholder||"search...",this.select=0,this.cacheKey=this.cacheKey||"_id",this.father=void 0,this.addingItem=!1;var a=this.base.match(/^\s*(\w+)\s+in\s+([\w.]+)\s*$/i);if(!a)throw new Error("list only supports ITEM in COLLECTION syntax.");this.item=a[1],this.list=[{name:void 0,list:i.flatTree(e(a[2])(t.$parent),angular.isUndefined(l.sortItems)===!1?function(e,t){return this.sortItems({a:e,b:t})}.bind(this):void 0)}],this.active=function(){return this.suggestions[this.select]&&this.suggestions[this.select][this.childrens]?(n.find(".aw-input").val(""),this.list.push({name:this.suggestions[this.select][this.filter],item:this.suggestions[this.select],list:this.suggestions[this.select][this.childrens]}),!0):!1},this.preAddItem=function(e){return this.list.length>1&&!this.list[this.list.length-1].add?(this.list.push({name:e,list:[],add:!0}),!0):!1},this.deductFather=function(){var e=void 0;if(this.list.length>1){for(var t=void 0,s=this.list.length-1;s>=0;s--)if(this.list[s].item){if(this.list[s].item[this.childrens].length>0){e=this.list[s].item;break}t=t||this.list[s].item}e||(e=this.list[0].list.filter(function(e){return e[this.cacheKey]==t.parent}.bind(this))[0]||this.list.find(function(e){return!!e.item}).item)}return e},this.requestItem=function(){this.getItem({name:this.list[this.list.length-1].name,father:this.father})},this.addItem=function(e){this.list[0].list.push(e),this.father?(this.father[this.childrens].push(e),this.father=void 0):this.list[0].list.filter(function(e){return e[this.cacheKey]==child.parent}.bind(this))[0][this.childrens].push(e)},this.extern={addItem:function(e){if(this.addingItem=!0,this.addItem(e),this.list.length>=2)for(var t=this.list.length-1;t>=0;t--)if(this.list[t].item&&this.list[t].item[this.childrens].length>0){this.list.splice(t+1,this.list.length-t,{name:e.label,item:e,list:[]});break}s.find("#preAdd").modal("hide")}.bind(this),clear:function(){this.list.splice(1,this.list.length-1)}.bind(this)}}],link:function(e,s,n,l,a){e.awesome.alias&&(e.$parent[e.awesome.alias]=e.awesome.extern||{});var o=s.find(".aw-input"),r=s.find(".aw-list"),h=s.find("#preAdd");h.appendTo(angular.element("body")),e.awesome.cancelFilter=function(t){e.awesome.list.splice(t,this.list.length-t),e.awesome.focus()},e.awesome.focus=function(){t(function(){o.focus()})},e.$watchCollection("awesome.suggestions",function(t){if(t){for(var s=function(s){angular.isUndefined(n.itemHeight)===!1&&s.height(e.awesome.itemHeight),r.append(i.cache.store(t[l][e.awesome.cacheKey],s,h));var a=angular.element(r.children()[l]);l<e.awesome.limit&&r.height(a.outerHeight()*(l+1)-l)},l=0,o=t.length;o>l;l++){var h=e.$new(!0);h[e.awesome.item]=t[l],h.$index=l,a(h,s)}i.cache.clearAll()}}),e.$watchCollection("awesome.list",function(t){e.awesome.suggestions=t[t.length-1].list,l.$setViewValue(t.length>1&&t[t.length-1].item?t[t.length-1].item:void 0),e.awesome.select=0}),o.on("input",function(){var t=o.val();e.show=!0,e.awesome.suggestions=i.filter(e.awesome.list[e.awesome.list.length-1].list,e.awesome.filter,t),e.awesome.select=0,e.$apply()}),o.on("keydown",function(t){var s=t.which||t.keyCode;(13==s||9==s)&&(e.awesome.active()?(t.preventDefault(),o.val("")):""!==o.val()&&angular.isUndefined(n.getItem)===!1&&e.awesome.preAddItem(o.val())&&(t.preventDefault(),o.val(""),h.modal("show"))),40==s?(t.preventDefault(),e.awesome.select=(e.awesome.select+1)%e.awesome.suggestions.length,e.awesome.select>=e.awesome.limit/2?r[0].scrollTop=r[0].scrollTop+angular.element(".aw-item.active").outerHeight()-1:0===e.awesome.select&&(r[0].scrollTop=0)):38==s&&(t.preventDefault(),e.awesome.select=e.awesome.select-1>-1?e.awesome.select-1:e.awesome.suggestions.length-1,e.awesome.select===e.awesome.suggestions.length-1?r[0].scrollTop=e.awesome.select*angular.element(".aw-item.active").outerHeight():e.awesome.select<e.awesome.suggestions.length-1-e.awesome.limit/2&&(r[0].scrollTop=r[0].scrollTop-angular.element(".aw-item.active").outerHeight()+1)),8==s&&""===o.val()&&e.awesome.list.length>1&&(t.preventDefault(),e.awesome.list.splice(e.awesome.list.length-1,1)),27==s&&(e.show=!1,o.trigger("blur")),e.$apply()}),r.on("mouseover",function(){e.hover=r.children().length>0,e.$apply()}),r.on("mouseleave",function(){e.hover=!1,e.$apply()}),o.on("focusout",function(){e.show=!1,e.$apply()}),o.on("focusin",function(){var s=o.val();e.awesome.suggestions=i.filter(e.awesome.list[e.awesome.list.length-1].list,e.awesome.filter,s),t(function(){e.show=r.children().length>0}),e.$apply()}),h.on("hide.bs.modal",function(){e.awesome.addingItem||(e.awesome.list.splice(e.awesome.list.length-1,1),e.awesome.father=void 0),e.awesome.addingItem=!1}),h.on("show.bs.modal",function(){e.awesome.father=e.awesome.deductFather()}),e.$watch("show",function(){e.show&&r.css({left:s.css("left"),width:s.css("width")})})}}}]),angular.module("netAwesome").directive("netAwesomeItem",function(){return{restrict:"E",require:"^netAwesome",replace:!0,templateUrl:"views/awesome.item.html",transclude:!0,link:function(e,t,s,i){t.on("mouseenter",function(){i.select=e.$index,e.$apply()}),t.on("click",function(t){i.active()&&(i.focus(),e.$apply())})}}}),angular.module("netAwesome").run(["$templateCache",function(e){e.put("views/awesome.component.html",'<div class="awesome form-group">\n  <div ng-class="{\'input-group\': awesome.list.length > 1}">\n    <span\n      class="input-group-addon aw-step"\n      ng-repeat="step in awesome.list"\n      ng-class="{\'aw-item-add\': step.add}"\n      ng-if="$index > 0">\n      {{ step.name }} <i class="glyphicon glyphicon-remove aw-cancel-item" ng-click="awesome.cancelFilter($index)"></i>\n    </span>\n    <input type="text" class="aw-input form-control" placeholder="{{awesome.placeholder}}"/>\n  </div>\n  <ul class="aw-list list-group" ng-show="show || hover">\n  </ul>\n  <div class="modal fade" id="preAdd" tabindex="-1" role="dialog" aria-labelledby="add" aria-hidden="true">\n    <div class="modal-dialog">\n      <div class="modal-content">\n        <div class="modal-header">\n          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n          <h4 class="modal-title"> Agregar item</h4>\n        </div>\n        <div class="modal-body">\n          Desea agregar <b>{{ awesome.list[awesome.list.length-1].name }}</b> a <b>{{ awesome.father.label }} </b>\n        </div>\n        <div class="modal-footer">\n          <button type="button" class="btn btn-default" data-dismiss="modal" ng-click="awesome.cancelAdd()">Cancelar</button>\n          <button type="button" class="btn btn-primary" ng-click="awesome.requestItem()">Agregar</button>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'),e.put("views/awesome.item.html",'<li class="list-group-item aw-item" ng-class="{active:$parent.awesome.select == $index}">\n    <span ng-transclude></span>\n</li>\n')}]),angular.module("netAwesome").service("AwesomeService",function(){this.flatTree=function(e,t){var s=function i(e){for(var t=[],s=0,n=e.length;n>s;s++)t.push(e[s]),e[s].items&&t.push.apply(t,i(e[s].items));return t}(e);return t&&s.sort(t),s},this.filter=function(e,t,s){return s=s||"",e.filter(function(e){return 0===e[t].indexOf(s)})},this.cache={stored:{},store:function(e,t,s){return this.stored[e]&&this.clear(e),this.stored[e]={clone:t,scope:s},this.stored[e].clear=!1,this.stored[e].clone},clear:function(e){this.stored&&(this.stored[e].clone.remove(),this.stored[e].scope.$destroy(),delete this.stored[e])},clearAll:function(){if(this.stored)for(var e in this.stored)this.stored[e].clear?this.clear(e):this.stored[e].clear=!0}}});